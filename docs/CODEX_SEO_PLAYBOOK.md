# Codex Viewer SEO Playbook

> Goal: make `frame.dev/codex` (and downstream deployments using `@framers/codex-viewer`) indexable like Wikipedia—static HTML per strand, stable URLs, metadata, and machine-readable sitemaps.

## 1. Current State

| Area | Status | Notes |
| --- | --- | --- |
| Rendering | Client-side only (`CodexViewer` fetches GitHub JSON) | Search bots see minimal HTML + loading states |
| URLs | `/codex?path=...&file=...` query params | Difficult for crawlers to discover |
| Metadata | `<title>` + OG meta handled at page level only | No per-strand meta, no schema.org |
| Sitemap | `frame.dev` sitemap excludes `/codex` strands | No canonical list of knowledge pages |
| Content source | GitHub (public) | Perfect for generating static artifacts |

## 2. SEO Requirements

1. **Server-rendered strand pages**  
   - Next.js App Router route such as `app/codex/[...slug]/page.tsx`.  
   - Fetch strand content at build time (Incremental Static Regeneration) or on-demand revalidation when GitHub updates.
2. **Deterministic URLs**  
   - Map `weaves/openstrand/schema/hierarchy.md` → `/codex/openstrand/schema/hierarchy`.  
   - Provide canonical `<link rel="canonical">`.
3. **Structured metadata**  
   - `<title>` and `<meta name="description">` derived from strand frontmatter.  
   - JSON-LD `Article` schema with `headline`, `dateModified`, `keywords`.
4. **XML sitemap + RSS**  
   - Use `next-sitemap` to emit `/sitemap-codex.xml`.  
   - Each strand entry: `<loc>`, `<lastmod>`, `<changefreq>weekly`, `<priority>0.7`.
5. **Content previews**  
   - Generate OG image per strand (e.g., using @vercel/og) to encourage sharing and increase click-through.
6. **Robots + canonical**  
   - Update `robots.txt` to include `Allow: /codex/`.  
   - Ensure `X-Robots-Tag` not blocking GitHub raw fetches (no change needed today).

## 3. Implementation Plan

### 3.1 Static Strand Pages

- Create Next.js server component `app/codex/[...segments]/page.tsx`.
- Use `generateStaticParams` to enumerate strands by reading `codex-index.json` (already generated by `apps/codex`).
- `fetch` markdown during build; reuse the same `stripFrontmatter` + `parseWikiMetadata` helpers.
- Render via `ReactMarkdown` + `rehype-raw` (already SSR-safe).
- Enable ISR: `export const revalidate = 3600` so Google gets fresh pages hourly.

### 3.2 Shared Data Loader

- Move GitHub fetch logic into `packages/codex-viewer/server` helper (Node-friendly).  
- Provide fallback to API route `/api/codex/strand?path=...` for client viewer.

### 3.3 SEO Metadata Hook

- Add utility `getStrandMetadata(strand)` returning `{ title, description, tags }`.
- In the new page route, export `generateMetadata` to populate Next.js metadata API.
- Include JSON-LD:
  ```ts
  const jsonLd = {
    '@context': 'https://schema.org',
    '@type': 'Article',
    headline: metadata.title,
    keywords: metadata.tags?.join(', '),
    dateModified: metadata.publishing?.lastUpdated,
    url: canonicalUrl,
    author: 'Frame.dev'
  }
  ```

### 3.4 Sitemaps

- Add `next-sitemap` config pointing to `https://frame.dev`.
- Extend `generateSitemaps` to pull from `codex-index.json`.
- Example entry:
  ```xml
  <url>
    <loc>https://frame.dev/codex/openstrand/schema/hierarchy</loc>
    <lastmod>2025-11-16</lastmod>
  </url>
  ```
- Run nightly GitHub Action to regenerate + commit `public/sitemap-codex.xml`.

### 3.5 Link Discovery

- Within the SPA viewer, add `<a href>` anchors pointing to the new static routes (progressive enhancement).  
- Example: clicking a strand triggers client navigation (current behavior) **and** wraps the title in `<Link href="/codex/openstrand/schema/hierarchy">`.
- Bots will follow the anchor even if JS is disabled.

### 3.6 Analytics + Search Console

- Submit sitemap to Google Search Console & Bing Webmaster Tools once the static routes ship.
- Track organic traffic separately by adding a GA4 secondary dimension `page_location` filtered to `/codex/*`.

## 4. Deployment Considerations

- **Build time**: if Codex has thousands of strands, use ISR with limited pre-render (e.g., top 200). The rest can defer to on-demand revalidation triggered by GitHub webhook hitting `/api/revalidate-codex`.
- **Rate limits**: GitHub API has 60 requests/hour unauthenticated. Use server-side token or read from `codex-index.json` stored in repo to avoid API calls during build.
- **Localization**: structured metadata easily extends with `lang` tags per weave (future).

## 5. Checklist

- [ ] Create static `[...segments]` route under `apps/frame.dev/app/codex`.
- [ ] Build helper to map slug ↔ file path (shared with viewer).
- [ ] Render markdown server-side + hydrate viewer for richer UX.
- [ ] Implement `generateMetadata` + JSON-LD per strand.
- [ ] Generate sitemap + robots updates.
- [ ] Add anchors/backlinks referencing canonical URLs.
- [ ] Document process in `wiki/codex/SEO.md`.

Once these steps are complete, Codex pages will look and behave like Wikipedia entries: crawlable HTML, structured data, and stable URLs—all while retaining the interactive viewer for logged-in humans.

